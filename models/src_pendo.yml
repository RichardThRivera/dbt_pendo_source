version: 2

sources:
  - name: pendo
    database: "{% if target.type != 'spark'%}{{ var('pendo_database', target.database) }}{% endif %}"
    schema: "{{ var ('pendo_schema', 'pendo') }}"

    loader: fivetran
    loaded_at_field: _fivetran_synced
      
    freshness:
      warn_after: {count: 72, period: hour}
      error_after: {count: 168, period: hour}


    tables:
      - name: account_application_history
        description: how relevant is multi-app stuff?

      - name: account_history
        description: >
          Table capturing the historical records of each account utilizing your product via Pendo. 
          Note that this table may contain custom metadata columns which can be passed through via `pendo__account_history_pass_through_columns`.
        columns:
          - name: id
            description: Unique identifier of the account.
          - name: first_visit
            description: The timestamp (UTC) of when the account or visitor was created. 
          - name: id_hash
            description: 32-bit hash of the visitor ID. 
          - name: last_updated_at
            description: The timestamp (UTC) of when the account was last updated.
          - name: last_visit
            description: The timestamp (UTC) of when Pendo last recorded an event for the account.

      - name: application_history
        description: Table capturing changes to your tracked application(s). TODO
        columns:
          - name: agent_policy_prod
            description: Production application policy.
          - name: agent_policy_staging
            description: Staging application policy.
          - name: agent_version_prod
            description: Version of the production app.
          - name: agent_version_staging
            description: Version of the staging app. 
          - name: application_flags_cname
            description: >
              Boolean that is true if CNAMEs are configured. CNAMES allows you to create hostnames under your own 
              applicationâ€™s domain which will be used in place of Pendo hostnames for both sending events and 
              downloading guide content
          - name: application_flags_disabled
            description: Boolean that is false if the application is disabled.
          - name: application_flags_guide_localization
            description: Boolean that is true if the pendo subscription has guide localization enabled. 
          - name: application_flags_guide_widget
          - name: application_flags_onboarding
          - name: application_flags_prevent_code_injection
          - name: application_flags_show_guides_to_anon
          - name: application_flags_xhr_timings
          - name: created_at
            description: Timestamp of when the application version record was created. 
          - name: created_by_user_id
            description: Foreign key referencing the `USER` who created the application.
          - name: description
            description: Description of the application. 
          - name: disabled_at
            description: Timestamp of when the application version was disabled. 
          - name: display_name
            description: Display name of the application. 
          - name: event_count
            description: Count of events tracked in this application. 
          - name: event_rate
          - name: first_event_time
          - name: guide_css_url
          - name: icon_url
          - name: id
            description: Unique ID of the application.
          - name: integrated
          - name: is_deleted
          - name: last_updated_at
          - name: last_updated_by_user_id
          - name: marked_for_deletion_at
          - name: name
          - name: datatype
          - name: platform
          - name: push_application_id
          - name: record_until
          - name: sampling_rate
          - name: starting_event_time
          - name: store_url
          - name: subscription_id

      - name: event
        description: Table capturing all recorded click and pageview events (tagged or untagged).
        columns:
          - name: account_id
            description: Foreign key referencing the `ACCOUNT` associated with the event, if any.
          - name: app_id
            description: Foreign key referencing the `APPLICATION` that the event was tracked in.
          - name: num_events
            description: Number of events tracked for this unique combination of day/hour, visitorId, accountId, server name, and IP address.
          - name: num_minutes
            description: Number of unique minutes of activity tracked for this unique combination of day/hour, visitorId, accountId, server name, and IP address.
          - name: page_id
            description: Foreign key referencing the `PAGE` that the event occurred on.
          - name: remote_ip
            description: The IP address of the event triggerer.
          - name: server_name
            description: Name of the server (your website) on which the event was tracked.
          - name: timestamp
            description: Day/hour-part timestamp of when the event occurred.
          - name: user_agent
            description: String identifying the browser and operating system on which the event was triggered.
          - name: visitor_id
            description: Foreign key referencing the `VISITOR` who triggered the event. 

      - name: feature_event
        description: Table capturing all recorded click events matching tagged features.
        columns:
          - name: account_id
            description: Foreign key referencing the `ACCOUNT` associated with the event, if any.
          - name: app_id
            description: Foreign key referencing the `APPLICATION` that the event was tracked in.
          - name: feature_id
            description: Foreign key referencing the `FEATURE` that the event is tagged with.
          - name: num_events
            description: Number of feature events tracked for this unique combination of day/hour, visitorId, accountId, server name, and IP address.
          - name: num_minutes
            description: Number of feature events minutes tracked for this unique combination of day/hour, visitorId, accountId, server name, and IP address.
          - name: remote_ip
            description: The IP address of the event triggerer.
          - name: server_name
            description: Name of the server (your website) on which the event was tracked.
          - name: timestamp
            description: Day/hour-part timestamp of when the event occurred.
          - name: user_agent
            description: String identifying the browser and operating system on which the event was triggered.
          - name: visitor_id
            description: Foreign key referencing the `VISITOR` who triggered the event. 

      - name: feature_history
        description: Table capturing historical records of features in Pendo.
        columns:
          - name: app_id
            description: Foreign key referencing the `APPLICATION` that the feature is a part of.
          - name: color
            description: Color value associated with the Feature. For visualization in Paths and Funnels.
          - name: created_at
            description: Timestamp of when the feature was created. 
          - name: created_by_user_id
            description: Foreign key referencing the `USER` that created the feature.
          - name: dirty
            description: Boolean value returned if feature is processing at the time of request.
          - name: group_id
            description: Foreign key referencing the `GROUP` (product area) that the feature is tagged under.
          - name: id
            description: Unique identifier of the feature.
          - name: is_core_event
            description: Boolean that is true if the feature is tagged as a core event/key feature of the product.
          - name: last_updated_at
            description: Timestamp of when the feature was last updated.
          - name: last_updated_by_user_id
            description: Foreign key referencing the `USER` that last updated the feature.
          - name: name
            description: Name of the feature.
          - name: page_id
            description: Foreign key referencing the `PAGE` that the feature is placed on.
          - name: root_version_id
            description: The unique identifier of the root entity, which nominally matches the public id field of the feature.
          - name: stable_version_id
            description: The unique identifier for the current version of the feature.
          - name: valid_through
            description: Timestamp that indicates when data was last processed.

      - name: group
        description: Table capturing the product areas.
        columns:
          - name: app_id
            description: Foreign key referencing the `APPLICATION` that the product area lives in.
          - name: color
            description: Color associated with the product area in the pendo UI.
          - name: created_at
            description: Timestamp of when the product area was created.
          - name: created_by_user_id
            description: Foreign key referencing the `USER` who created the product area.
          - name: description
            description: Description of the product area.
          - name: id
            description: Unique identifier of the product area. 
          - name: last_updated_at
            description: Timestamp of when the product area was last updated.
          - name: last_updated_by_user_id
            description: Foreign key referencing the `USER` who last updated the product area.
          - name: length
            description: The number of features/pages tagged under this product area. The transform package will recalculate this as it is not to be trusted....
          - name: name
            description: Name of the product area.

      - name: guide_event
        description: Table capturing events related to guides. Each row is a unique event around `guideAdvanced`, `guideSeen`, `guideDismissed`, `guideSnoozed`, `guideTimeout`, `guideActivity`.
        columns:
          - name: account_id
            description: Foreign key referencing the `ACCOUNT` associated with the event triggerer, if any. 
          - name: app_id
            description: Foreign key referencing the `APPLICATION` the event was triggered in.
          - name: country
            description: Country in which the guide event was recorded.
          - name: element_path
            description: The element path that indicates where the guide can be found (blank if not applicable).
          - name: event_id
            description: TODO - figure out?
          - name: guide_id
            description: Foreign key referencing the `GUIDE` that was interacted with.
          - name: guide_step_id
            description: Foreign key referencing the `STEP` within the guide that was interacted with specifically. 
          - name: latitude
            description: Latitude of where the event was triggered from, if location is provided.
          - name: load_time
            description: Load time of the guide event.
          - name: longitude
            description: Longitude of where the event was triggered from, if location is provided.
          - name: region
            description: Geographic region of the triggered event, if location is provided.
          - name: remote_ip
            description: IP Address of the event triggerer.
          - name: server_name
            description: Name of the server (your website) on which the event was tracked.
          - name: timestamp
            description: Day/hour-part timestamp of when the event occurred.
          - name: type
            description: Type of guide event that was tracked. Can be one of `guideAdvanced`, `guideSeen`, `guideDismissed`, `guideSnoozed`, `guideTimeout`, `guideActivity`.
          - name: url
            description: URL on which the guide event was recorded.
          - name: user_agent
            description: String identifying the browser and operating system on which the event was triggered.
          - name: visitor_id
            description: Foreign key referencing the `VISITOR` who triggered the event.

      - name: guide_history
        description: Table capturing historical records of guides in pendo.
        columns:
          - name: app_id
            description: Foreign key referencing the `APPLICATION` that the guide belongs in.
          - name: attribute_badge_can_change_badge_color
            description: Boolean that is true if the guide badge's color can be changed. 
          - name: attribute_badge_color
          - name: attribute_badge_height
          - name: attribute_badge_image_url
          - name: attribute_badge_is_only_show_once
          - name: attribute_badge_name
          - name: attribute_badge_offset_left
          - name: attribute_badge_offset_right
          - name: attribute_badge_offset_top
          - name: attribute_badge_position
          - name: attribute_badge_show_on_event
          - name: attribute_badge_use_hover
          - name: attribute_badge_width
          - name: attribute_device_type
          - name: attribute_priority
          - name: attribute_type
          - name: created_at
            description: Timestamp of when the guide was created.
          - name: created_by_user_id
            description: Foreign key referencing the `USER` who created the guide. 
          - name: email_state
          - name: id
          - name: is_multi_step
          - name: is_training
          - name: last_updated_at
          - name: last_updated_by_user_id
          - name: launch_method
          - name: name
          - name: published_at
          - name: recurrence
          - name: recurrence_eligibility_window
          - name: reset_at
          - name: root_version_id
          - name: stable_version_id
          - name: state

      - name: guide_step_history
        columns:
          - name: guide_id
          - name: guide_last_updated_at
          - name: step_id

      - name: page_event
        columns:
          - name: account_id
          - name: app_id
          - name: num_events
          - name: num_minutes
          - name: page_id
          - name: param_parameter
          - name: remote_ip
          - name: server_name
          - name: timestamp
          - name: user_agent
          - name: visitor_id

      - name: page_history
        columns:
          - name: app_id
          - name: color
          - name: created_at
          - name: created_by_user_id
          - name: dirty
          - name: group_id
          - name: id
          - name: last_updated_at
          - name: last_updated_by_user_id
          - name: name
          - name: root_version_id
          - name: stable_version_id
          - name: valid_through

      - name: page_rule_history
        columns:
          - name: designer_hint
          - name: page_id
          - name: page_last_updated_at
          - name: parsed_rule
          - name: rule

      - name: user
        columns:
          - name: deleted_at
          - name: first_name
          - name: id
          - name: last_name
          - name: role
          - name: user_type
          - name: username

      - name: visitor_history
        columns:
          - name: account_id
          - name: first_visit
          - name: id
          - name: id_hash
          - name: last_browser_name
          - name: last_browser_version
          - name: last_operating_system
          - name: last_server_name
          - name: last_updated_at
          - name: last_user_agent
          - name: last_visit
          - name: n_id